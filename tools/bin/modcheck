#!/usr/bin/env bash

exit=0
while read -r line; do
    IFS=' ' read -r mod why <<< "$line"
    go mod edit -json | jq -r '.Require[] | select(.Indirect != true) | .Path' | grep "$mod"
    if test $? -ne 1
    then
      echo "$mod is not allowed: $why"
      echo ""
      exit=1
    fi
done <"$1"

exit $exit
